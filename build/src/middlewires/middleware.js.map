{"version":3,"file":"middleware.js","names":["Authorization","req","res","next","blog","post","Post","findOne","username","token","headers","authorization","decodedToken","jwt","verify","process","env","JWT_SECRET","user","User","findById","_id","status","json","message","error","Error"],"sources":["../../../src/middlewires/middleware.js"],"sourcesContent":["import jwt from 'jsonwebtoken';\r\nimport  User from \"../models/User.js\";\r\nimport Post from \"../models/Post.js\"; \r\n  export default  async function  Authorization(req, res, next) {\r\n    try{\r\n    const blog = req.blog;\r\n    const post =await Post.findOne({username});\r\n    const token = req.headers.authorization;\r\n      if(token){\r\n     var decodedToken = jwt.verify(token, process.env.JWT_SECRET);;\r\n      const  user  =  await User.findById(decodedToken._id);\r\n      const post =await Post.findOne({username});\r\n      \r\n    if (post.username !== user.username) {\r\n      return res.status(403).json({ message: 'Forbidden' });\r\n    }else{\r\n        next();\r\n    }\r\n    }\r\nelse{\r\n    return res.status(403).json({ message: 'you are not authorised' });\r\n}}\r\n    catch(error) {\r\n       return  res.status(401).json({ error: new Error('Invalid request!') });\r\n        }};\r\n    "],"mappings":";;;;;;AAAA;AACA;AACA;AAAqC;AACnB,eAAgBA,aAAa,CAACC,GAAG,EAAEC,GAAG,EAAEC,IAAI,EAAE;EAC5D,IAAG;IACH,MAAMC,IAAI,GAAGH,GAAG,CAACG,IAAI;IACrB,MAAMC,IAAI,GAAE,MAAMC,aAAI,CAACC,OAAO,CAAC;MAACC;IAAQ,CAAC,CAAC;IAC1C,MAAMC,KAAK,GAAGR,GAAG,CAACS,OAAO,CAACC,aAAa;IACrC,IAAGF,KAAK,EAAC;MACV,IAAIG,YAAY,GAAGC,qBAAG,CAACC,MAAM,CAACL,KAAK,EAAEM,OAAO,CAACC,GAAG,CAACC,UAAU,CAAC;MAAC;MAC5D,MAAOC,IAAI,GAAK,MAAMC,aAAI,CAACC,QAAQ,CAACR,YAAY,CAACS,GAAG,CAAC;MACrD,MAAMhB,IAAI,GAAE,MAAMC,aAAI,CAACC,OAAO,CAAC;QAACC;MAAQ,CAAC,CAAC;MAE5C,IAAIH,IAAI,CAACG,QAAQ,KAAKU,IAAI,CAACV,QAAQ,EAAE;QACnC,OAAON,GAAG,CAACoB,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAAEC,OAAO,EAAE;QAAY,CAAC,CAAC;MACvD,CAAC,MAAI;QACDrB,IAAI,EAAE;MACV;IACA,CAAC,MACD;MACA,OAAOD,GAAG,CAACoB,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,OAAO,EAAE;MAAyB,CAAC,CAAC;IACtE;EAAC,CAAC,CACE,OAAMC,KAAK,EAAE;IACV,OAAQvB,GAAG,CAACoB,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MAAEE,KAAK,EAAE,IAAIC,KAAK,CAAC,kBAAkB;IAAE,CAAC,CAAC;EACrE;AAAC;AAAC"}